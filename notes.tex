\documentclass[11pt,oneside]{amsbook}

\title{Real and linear analysis}
\author{Course notes based on material from\\``Measure theory'' by Terence Tao, and\\``Real analysis'' by Bruckner, Bruckner, and Thompson}

\usepackage[vscale=.8,vmarginratio=4:3]{geometry}
\usepackage{mathpazo,amssymb}
\usepackage{setspace}\onehalfspacing\raggedbottom
\renewcommand{\labelitemi}{$\circ$}
\renewcommand{\labelenumi}{(\alph{enumi})}
\renewcommand{\chaptername}{Part}
\renewcommand{\thechapter}{\Roman{chapter}}
\usepackage{remreset}
\makeatletter\@removefromreset{section}{chapter}\makeatother
\usepackage{etoolbox}
\makeatletter
\pretocmd{\@seccntformat}{\S}{}{}
\patchcmd{\tocsection}{#2.}{\S#2.}{}{}
\apptocmd{\tocsection}{\dotfill}{}{}
\makeatother
\usepackage[linktoc=all]{hyperref}
\usepackage{tikz}

\newcommand{\set}[1]{\left\{\,#1\,\right\}}
\renewcommand{\setminus}{\smallsetminus}
\newcommand{\NN}{\mathbb N}
\newcommand{\ZZ}{\mathbb Z}
\newcommand{\QQ}{\mathbb Q}
\newcommand{\RR}{\mathbb R}
\DeclareMathOperator{\len}{len}
\DeclareMathOperator{\vol}{vol}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\rng}{rng}

\theoremstyle{definition}
\newtheorem{exerc}{Exercise}[section]
\swapnumbers
\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section]
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}
\theoremstyle{remark}
\newtheorem{rem}[thm]{Remark}
\newtheorem{example}[thm]{Example}
\newtheorem*{notes}{Notes and further reading}
\newtheorem*{reading}{Reading}
\numberwithin{equation}{section}
\numberwithin{figure}{section}
\renewcommand{\theequation}{\arabic{section}.e\arabic{equation}}
\renewcommand{\thefigure}{\arabic{section}.f\arabic{figure}}

\begin{document}

\maketitle

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Measure theory}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The measure problem}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{reading}
  Tao, \S1.1 introduction, and \S1.2.3.
\end{reading}

``Measure'' is a number assigned to a set which represents its size. There are many senses in which we may mean size. Some of these are length, area, volume, mass, and even probability. Note that other senses of size such as cardinality, diameter, and density are not usually associated with measure.

The problem of finding a measure thus sounds geometric. But given our models of space, in which coordinate axes are indexed by infinitesimal points drawn from the real number system, the problem really turns out to be analytic. (In particular, this means lots of $\epsilon$'s will show up!)

The classical problem of finding a measure can be made into a formal mathematical question as follows: Does there exist a measure function $m$ which assigns to each subset $A\subset\RR$ a value $m(A)\in[0,\infty]$ satisfying:
\begin{enumerate}
\item (normality) $m(I)=$ the length of $I$ for every interval $I$;
\item (translation-invariance) $m(x+A)=m(A)$ for every $A$; and
\item (countable additivity) $m(\bigcup A_n)=\sum m(A_n)$ for every seqence of pairwise disjoint sets $A_n$.
\end{enumerate}

Perhaps surprisingly, no such measure function exists! The three very natural properties (a)--(c) actually turn out to be mutually inconsistent.

\begin{thm}[Vitali]
  There exists a set $A\subset\RR$ such that no measure can be assigned to $A$ consistently with (a)--(c).
\end{thm}

\begin{proof}
  We will consider just the unit interval $[0,1)$ with addition modulo $1$. If there is a measure $m$ on all subsets of $\RR$, then by conditions (b) and (c), $m$ restricts to a measure on subsets of $[0,1)$ which satisfies (b) with respect to addition modulo $1$.

  Now let $\QQ_1$ denote the rationals of $[0,1)$, that is, $\QQ_1=\QQ\cap[0,1)$, and consider the collection of additive cosets of $\QQ_1$ inside $[0,1)$. The cosets are of the form $a+\QQ_1$ where again addition is interpreted modulo $1$. We now let $A\subset[0,1)$ denote a system of coset representatives for this collection.

  Now every number in $[0,1)$ can be written uniquely as $a+q$ for $a\in A$ and $q\in\QQ_1$. This means that the collection of translates of $A$ by elements $q\in\QQ_1$ covers all of $[0,1)$. In particular, by (a) the measure of $\bigcup_{q\in\QQ_1}(A+q)$ is exactly $1$.

  On the other hand, by (b) and (c) we have that
  \[m\left(\bigcup\nolimits_{q\in\QQ_1}(A+q)\right)
  =\sum\nolimits_{q\in\QQ_1}m(A+q)=\sum\nolimits_{q\in\QQ_1}m(A)
  \]
  By the previous paragraph, the left-hand side of the above equation is $1$. On the other hand the right-hand side is an infinite sum of some nonnegative constant, and hence must be either $0$ or $\infty$. This is a contradiction!
\end{proof}

We remark that it is possible to modify the argument to apply directly to a measure on $\RR$ rather than going via the unit interval with addition modulo $1$. See Tao for this version.

The lesson is that we must weaken our demands on a measure $m$. Dropping condition (a) can lead to trivial measures. Dropping conditon (b) leads to several interesting problems in set theory. Weakening condition (c) to finite additivity leads to interesting solutions, but only in dimensions $\leq2$. (In dimensions $\geq3$ the Banach--Tarski paradox again gives a contradiction.)

Yet the simplest path forward (and the one that we take) is to drop the condition that \emph{every} set be measurable. The set $A$ constructed in Vitali's proof is very artificial and isn't likely to occur in any of the most commin analytical applications (see the notes below). We will simply drop the requirement that $A$ and other sets like it be in the domain of $m$. In the end, our measure function have a domain which is a proper subset of $\mathcal P(\RR)$ but still contains a rich class of sets. And it will satisy properties (a)--(c) for all the sets in its domain.

Of course we are also interested in the measure problem for subsets $\RR^n$. It can be formulated in just the same way, with condition (a) replaced by the condition that the measure of a box is equal to its volume. And a Vitali-type result can also easily be established for this version of the measure problem.

In the next section, we will begin this process by taking a step backwards and build measures with much smaller domains, and satisfying just fragments of (a)--(c).

\begin{notes}
  The proof of Vitali's theorem requires the Axiom of Choice. Specifically, it is needed to find a system of coset representatives for an uncountable collection. Solovay showed that the use of AC is essential, and that it is consistent with $\neg$AC that every set is measurable.
\end{notes}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elementary measure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{reading}
  Tao, \S1.1.1
\end{reading}

In this section we define a very simple measure on $\RR^n$ which is capable just of measuring a very simple type of set. The development serves two purposes: first it reveals some of the techniques which we will use later, and second it will be used explicitly in the construction of more powerful measures.

Recall that an \emph{interval} is any subset of $\RR$ of the form $(a,b)$, $[a,b)$, $(a,b]$, or $[a,b]$. We shall use the term \emph{box} for any subset of $\RR^n$ which is a Cartesian product of intervals.

\begin{defn}
  A subset $E\subset\RR^n$ is \emph{elementary} if it can be expressed as a union of finitely many boxes.
\end{defn}

In defining elementary measure, we of course assign the measure of each interval $I=(a,b)$ or $[a,b)$ or $(a,b]$ or $[a,b]$ to simply be its length; thus in all four cases $\len(I)=b-a$. Next we define the volume of a box $B=\prod I_n$ to be the product of its side lengths; thus $\vol(B)=\prod\len(I_n)$. Great.

We now wish to define the measure of an elementary set to be the sum of the finitely many boxes it is composed of. However there are two issues with this: first the constituent boxes need not be disjoint, and second there is in general more than one way to express an elementary set as a union of boxes. The following two lemmas address these two issues.

\begin{lem}
  Any elementary set $E$ can be expressed as a finite union of disjoint boxes.
\end{lem}

\begin{proof}
  First assume that $E\subset\RR^1$ and that $E=\bigcup I_i$. Then by considering all endpoints of the $I_i$ in increasing order $a_1,\ldots,a_m$ it is easy to write $E$ as the union of sets of the form $(a_i,a_{i+1})$ together with sets of the form $[a_i,a_i]$ (single points). Such a union is clearly disjoint.

  In general if $E\subset\RR^n$ and $E=\bigcup B_i$ then for each dimension $d\leq n$ consider in turn the $d$th sides of the boxes $I_i^d$. Again consider the endpoints of these intervals in increasing order $a_i^d,\ldots,a_{m_d}^d$. Then we can write $E$ as a union of small boxes which are products of sets of the form $(a_i^d,a_{i+1}^d)$ or of the form $[a_i^d,a_{i+1}^d]$. Such boxes are again disjoint.
\end{proof}

\begin{lem}
  Suppose the elementary set $E$ can be expressed in two ways a a finite union of disjoint boxes: $E=\bigsqcup B_i=\bigsqcup C_j$. Then $\sum\vol(B_i)=\sum\vol(C_j)$.
\end{lem}

\begin{proof}
  We first note that $I$ is an interval with endpoints $a,b$, and if $a=a_1,a_2,\ldots,a_m=b$ is an increasing sequence then $\len(I)=\sum\len(a_i,a_{i+1})$. This is simply because the latter summation telescopes.
  
  Next if $B$ is a box whose $d$th side has endpoints $a^d,b^d$, and if $a^d=a_1^d,a_2^d,\ldots,a_{m_d}^d=b^d$ then $\vol(B)=$ the sum of all small boxes of the form $\prod(a_{i_d}^d,a_{i_d+1}^d)$. We will call the set of such small boxes a perfect grid. Intuitively, if you break a box into a perfect grid of sub-boxes, then the volume of the box is the sum of the volumes of the sub-boxes.

  Now if $B$ is a box and one expresses it as a disjoint union of sub-boxes $B=\bigsqcup B_i$, then $\vol(B)=\sum\vol(B_i)$. This is because it is possible to find a refinement of the disjoint union $B=\bigcup D_i$ where $\{D_i\}$ is a perfect grid as in the previoius paragraph, and each $B_i$ is the union of a perfect grid of sets all of which are in the collection $\{D_i\}$. Then one can simply apply the argument of the previous paragraph to $B$ and to each $B_i$.

  Finally given $E$, $B_i$, and $C_j$ as in the problem statement, one can find a third expression $E=\bigsqcup E_k$ where $\{E_k\}$ is a \emph{refinement} of both $\{B_i\}$ and of $\{C_j\}$. That is, each $B_i$ and each $C_j$ is a disjoint union of elements of $\{E_k\}$. It follows from the previous paragraph that $\sum\vol(B_i)=\sum\vol(E_k)$ and analogously that $\sum\vol(C_j)=\sum\vol(E_k)$. This completes the proof.
\end{proof}

The two lemmas together imply that it is well-defined to define the elementary measure function on elementary sets by writing $m(\bigsqcup B_i)=\sum m(B_i)$.

\begin{prop}
  The elementary measure function $m$ satisfies
  \begin{enumerate}
  \item (normality) $m(B)=\vol(B)$ for $B$ a box;
  \item (translation-invariance) $m(x+E)=m(E)$ for $E$ elementary; and
  \item (finite additivity) $m(E\cup F)=m(E)+m(F)$ for disjoint elementary $E,F$.
  \end{enumerate}
\end{prop}

Normality is clear from the defenition of $m$. The translation-invarinace is easy because it is true of length and volume, and moreover is preserved even when we take disjoint unions. The finite additivity property is again clear from the definition of $m$. We remark that $m$ satisfies countable additivity as well (restricted to elementary sets of course), but that is much more difficult and will be addressed later on.

The above three core properties imply further useful properties as well.

\begin{prop}
  The elementary measure function $m$ satisfies
  \begin{itemize}
  \item (monotonicity) $m(E)\leq m(F)$ for elementary sets $E\subset F$; and
  \item (finite subadditivity) $m(E\cup F)\leq m(E)+m(F)$ for elementary $E,F$.
  \end{itemize}
\end{prop}

These results give an essentially complete solution to the measure problem for elementary sets. It wasn't too difficult to achieve, but perhaps not as easy as one would have thought! Even so, what about measuring other simple sets such as circles, triangles, blobs, Cantor sets, and so on? In the next section we will continue on the road to doing this.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Jordan measure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{reading}
  Tao, \S1.1.2.
\end{reading}

In the previous section we showed that the intuitive definition of area is sensible for elementary sets, but then remarked that simple shapes like polygons and circles are not elementary. It is easy to imagine extending the elementary measure to triangles by cutting, and to polygons by applying rotations, stretches, and skews. However no such operation (called \emph{affine} transformations) can help measure a circle.

Instead we will measure the circle the way it has always been done, by using \emph{approximation}. It is not hard to visualize a circle being approximated by elementary sets, using smaller and smaller boxes near the boundary. The approximation technique will help us measure most traditional geometric figures, and even many blobby thingies.

\begin{defn}
  Let $E$ be a bounded subset of $\RR^n$. First define the \emph{inner} and \emph{outer Jordan} measures (sometimes called lower and upper):
  \begin{align*}
    m_{*j}&=\inf\set{m(A):A\subset E,\, A\text{ elementary}}\\
    m^{*j}&=\inf\set{m(B):E\subset B,\, B\text{ elementary}}
  \end{align*}
  Then if $m_{*j}(E)=m^{*j}(E)$ we say that $E$ is \emph{Jordan measurable}, call the common quantity the \emph{Jordan measure} of $E$, and denote it by $m(E)$.
\end{defn}

It is immediate from the definition Jordan measure extends elementary measure in the sense that they agree on the elementary sets. This means we are justified in using ``$m$'' both for the elementary and Jordan measure. Moreover, we will show that the Jordan measure inherits many of the properties of the elementary measure: normality, translation-invariance, finite additivity, monotonicity, and finite subadditivity.

The normality and translation-invariance properties hold simply because they hold for elementary measure. The finite properties will take a little more work. For instance, in order to even state the finite additivity property, we first need to establish Boolean closure: the union of measurable sets is measurable.

Before we begin these results, it will be useful to establish the following characterization of Jordan measurability. As we will be working with approximations, the following results also illustrate our first use of $\epsilon$-style analytical arguments.

\begin{lem}
  \label{lem:jordan-equiv}
  The set $E$ is Jordan measurable if and only if either of the following holds:
  \begin{itemize}
  \item For all $\epsilon>0$ there are elementary sets $A,B$ such that $A\subset E\subset B$ such that $m(B\setminus A)<\epsilon$.
    % Note: for homework students should show the difference of elementary sets is elementary
  \item For all $\epsilon>0$ there is an elementary set $A$ such that $m(E\triangle A)=0$.
  \end{itemize}
\end{lem}

\begin{proof}
  We establish only the equivalence of Jordan measurability with the first item. To begin, assume that $E$ is Jordan measurable and let $\epsilon>0$ be given. By the $m_{*j}$ definition of Jordan measure, we can find an elementary set $A\subset E$ such that $m(E)-m(A)<\epsilon/2$. By the $m^{*j}$ definition of jordan measure we can find an elementary set $B$ such that $E\subset B$ and $m(B)-m(E)<\epsilon/2$. It follows that 
\[m(B\setminus A)=m(B)-m(A)=(m(B)-m(E))-(m(E)-m(A))<\epsilon
\]
as desired.

  For the converse, assume that the first item is true, and let $\epsilon>0$ be arbitrary. Then we can find elementary sets $A,B$ such that $A\subset E\subset B$ and $m(B)-m(A)<\epsilon$. From the definitions of inner and outer Jordan measure, we have that $m(A)\leq m_{*j}(E)\leq m^{*j}(E)\leq m(B)$. It follows that $m^{*j}(E)-m_{*j}(E)<\epsilon$. Since $\epsilon$ was arbitrary, we may conclude that $m_{*j}(E)=m^{*j}(E)$ and therefore that $E$ is Jordan measurable.
\end{proof}

Note that in the proof, one has to be careful when making a claim such as $m(B\setminus A)=m(B)-m(A)$. It is true in these cases because: the elementary sets are closed under set differences, and so all three sets are elementary, together with the finite additivity property for elementary measure.

\begin{prop}
  If $E,F$ are Jordan measurable, then so are $E\cup F$, $E\cap F$, and $E\setminus F$.
\end{prop}

\begin{proof}
  We prove only the case of $E\cup F$. Suppose that $E,F$ are Jordan measurable. By the previous lemma, we can find elementary sets $A,B,A',B'$ such that $A\subset E\subset B$, and $A'\subset F\subset B'$, and $m(B\setminus A),m(B'\setminus A')<\epsilon/2$. Then we have $A\cup A'\subset E\cup F\subset F\cup F'$ and using some algebra together with the finite subadditivity of elementary measure, $m(B\cup B'\setminus(A\cup A'))\leq m(B\setminus A)+m(B'\setminus A')<\epsilon$. Again by the previous lemma, this shows that $E\cup F$ is Jordan measurable.
\end{proof}

We are now ready to establish the remaining stated properties of Jordan measure. The following result states finite additivity, and the first paragraph of its proof gives finite subadditivity. The monotonicity property follows immediately from finite additivity.

\begin{thm}
  The Jordan measure satisfies finite additivity, that is, if $E,F$ are Jordan measurable and disjoint, then $m(E\cup F)=m(E)+m(F)$.
\end{thm}

\begin{proof}
  We first show subbaditivity, that is, that $m(E\cup F)\leq m(E)+m(F)$. Let $\epsilon>0$ be given. Using the fact that $m=m^{*j}$ we can find elementary sets $B,B'$ such that $E\subset B$, $F\subset B'$, $m(B)-m(E)<\epsilon/2$, and $m(B')-m(F')<\epsilon/2$. Using the monotonicity and subadditivity properties of the elementary measure, together with the definition of Jordan measurability, we now have:
  \begin{align*}
    m(E\cup F)&=m^{*j}(E\cup F)\\
              &\leq m(B\cup B')\\
              &\leq m(B)+m(B')\\
              &< m(E)+m(F)+\epsilon
  \end{align*}
  Since $\epsilon$ was arbitrary, we achieve the desired inequality.
% question: do we need to use the outer version here?
  
  Now additionally assume that $E,F$ are disjoint, and again let $\epsilon>0$. This time using $m=m_{*j}$, we can find elementary sets $A,A'$ such that $A\subset E$, $A'\subset E'$, $m(E)-m(A)<\epsilon/2$, and $m(F)-m(A')<\epsilon/2$. Using the fact that $A,A'$ are disjoint, the finite additivity of elementary measure, and the definition of Jordan measurability, we now have:
  \begin{align*}
    m(E\cup F)&=m_{*j}(E\cap F)\\
              &\geq m(A\cup A')\\
              &=m(A)+m(A')\\
              &>m(E)+m(F)-\epsilon
  \end{align*}
  Again letting $\epsilon$ tend to $0$, we achieve that $m(E\cup F)\geq m(E)+m(F)$.
\end{proof}

While you probably have a clear idea of what the elementary sets look like, it is now time to give some examples and non-examples of Jordan measurable sets. Some simple but useful new examples are the axis-parallel triangles. Suppose $T$ is an axis-parallel triange with leg lenghs $a$ and $b$. To prove that $T$ is Jordan measurable, note that two copies of $T$ essentially make up a box with area $ab$. Using the finite additivity, this implies that the measure of $T$ is the expected $ab/2$.

To make this argument we need to know that Jordan measure is invariant under $180^\circ$ rotation, which is clear because it is true for boxes. But also since the two copies of $T$ overlap in a line segment, we also need to know that the Jordan measure of a line segment is $0$. This fact follows from the more general result below.

\begin{lem}
  \label{lem:jordan-graph}
  Let $f$ be a continuous function defined on a closed, bounded interval. Then the graph of $f$, considered as a subset of $\RR^2$, has Jordan measure $0$.
\end{lem}

\begin{proof}
  Let $I$ denote the domain of $f$. Recall that since $I$ is closed and bounded, it is \emph{compact}. Recall also that a continuous function with a compact domain is \emph{uniformly continuous}: for any $\epsilon>0$ there exists a $\delta>0$ such that for any interval $J$, $\len(J)<\delta$ implies $\len(f(J))<\epsilon$.

  So let $\epsilon>0$ be given, and choose $\delta>0$ as above. Shrinking $\delta$ if necessary, we can suppose that $\len(I)/\delta$ is an integer $k$. Partitioning $I$ into intervals $J_1,\ldots,J_k$ each of lengh $\delta$, we have that the graph of $f$ is contained in the set
  \[E=\bigcup_{i\leq k} J_i\times[\min f(J_i),\max f(J_i)]
  \]
  Note that the min and max values in the definition of $E$ exist by the extreme value theorem. Now $E$ is a union of $k$ many rectangles each of size at most $\delta\epsilon$. Thus $E$ is elementary and its measure is at most $k\delta\epsilon$. This latter value is $\len(I)\epsilon$, so the upper measure $m^{*j}$ of the graph of $f$ is at most $\len(I)\epsilon$. Taking $\epsilon\to0$, we conclude that $f$ is Jordan measurable with measure $0$.
\end{proof}

It is now not difficult to conclude that all polygons are Jordan measurable and have the expeted measure. This is because all polygons can be decomposed into a union of axis parallel triangles (possibly overlapping on their measure zero edges).

A simple example of a set which is not Jordan measurable is the set $\QQ_1=\QQ\cap[0,1]$ of rational numbers in the unit interval. Indeed the only elementary sets $A\subset\QQ_1$ are the finite sets, and so $m_{*j}(\QQ_1)=0$. And the only elementary sets $B$ such that $\QQ_1\subset B$ are of the form $[0,1]\setminus F$ where $F$ is finite, and so $m^{*j}(\QQ_1)=1$.

We can conclude from these examples that Jordan measure works very well for classical geometric objects, but not very well even for simple analytic objects such as countable dense sets, the Cantor set, and so forth. To handle such sets, we will soon work to describe the Lebesgue measure, which  satisfies \emph{countable} additivity. Before going to such generality, however, we explore the connection between Jordan measure and the Riemann integral.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Riemann integration}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{reading}
  Tao, \S1.1.3.
\end{reading}

If the picture of Lemma~\ref{lem:jordan-graph} reminded you of Riemann sums, it should. Measure theory is closely connected to integration theory, as both are concerned with calculating areas of some regions. Moreover the Jordan measure corresponds neatly with the Riemann integral. The following presentation of the Riemann integral is actually attributed to Darboux.

Just as we defined the elementary measure before we defined the Jordan measure, we will now define the ``piecewise constant'' integral before we define the Riemann integral.

\begin{defn}
  Let $f$ be a real-valued function defined on $[a,b]$. Then $f$ is said to be \emph{piecewise constant} if there exists a partition $\mathcal P$ of $[a,b]$ into subintervals $I_j$ such that $f$ takes a constant value $c_j$ on each interval $I_j$.
\end{defn}

In other words, $f$ is piecewise constant if $f$ is of the form $\sum c_j\chi_{I_j}$, where $I_j$ are intervals. Here $\chi_{I_j}$ denotes the \emph{characteristic function} of $I_j$, that is, $\chi_{I_j}(x)=1$ if $x\in I_j$ and $\chi_{I_j}(x)=0$ otherwise.

\begin{defn}
  If $f=\sum c_j\chi_{I_j}$ then the \emph{pc integral} of $f$ is defined to be $\sum c_j\len I_j$.
\end{defn}

As was the case with the elementary measure, one must check that the value of the pc integral is well-defined. That is, if $f$ is expressed in two different ways as a pc function, say $\sum c_j\chi_{I_j}=\sum d_k\chi_{J_k}$, then one must check that the two values $\sum c_j\len(I_j)$ and $\sum d_k\len(J_k)$ agree.

\begin{defn}
  Let $f$ be a bounded function on $[a,b]$. First define the lower and upper Riemann forms:
  \begin{align*}
    \underline\int f&=\sup\set{\left.\text{pc}\!\!\int\!\! f\;\right|\;g\leq f\text{, $g$ pc}}\\
    \overline\int f&=\inf\set{\left.\text{pc}\!\!\int\!\! h\;\right|\;f\leq h\text{, $h$ pc}}
  \end{align*}
  Then if $\underline\int f=\overline\int f$ we say that $f$ is \emph{Riemann integrable}, and denote the common value simply by $\int f$.
\end{defn}

\begin{prop}
  The Riemann integral satisfies the three properties:
  \begin{itemize}
  \item (normality) If $E$ is a Jordan measurable subset of $[a,b]$, then $\chi_E$ is Riemann integrable over $[a,b]$ and $\int\chi_E=m(E)$.
  \item (linearity) If $f,g$ are Riemann integrable then so are $cf$ and $f+g$ and we have $\int cf=c\int f$, and $\int(f+g)=\int f+\int g$.
  \item (monotonicity) If $f,g$ are Riemann integrable and $f\leq g$ then $\int f\leq \int g$.
  \end{itemize}
\end{prop}

\begin{proof}
  We establish only the normality property. By Lemma~\ref{lem:jordan-equiv}, for any $\epsilon$ we can find disjoint intervals $I_j$ and disjoint intervals $J_k$ such that $\bigcup I_j\subset E\subset\bigcup J_k$ and $m(\bigcup J_k\setminus\bigcup I_j)<\epsilon$. It is easy to see from the definition of the pc integral that $\text{pc}\int\chi_{\bigcup I_j}=m(\bigcup I_i)$, and similarly $\text{pc}\int\chi_{\bigcup J_k}=m(\bigcup J_k)$. We now have
  \[m(\bigcup I_i)\leq\underline\int\chi_E\leq\overline\int\chi_E
  \leq m(\bigcup J_k)
  \]
  Since the left and right-hand sides differ by $<\epsilon$, it follows that the lower and upper integrals differ by $<\epsilon$ as well. Since $\epsilon$ was arbitrary, it follows that $\chi_E$ is integrable. And since we also have
  \[m(\bigcup I_i)\leq m(E)\leq m(\bigcup J_k)
  \]
  we may conclude that $\int\chi_E$ is equal to $m(E)$.
\end{proof}

If one re-examines the definition and properties of the Jordan measure, it should be that there is a close parallel between the Riemann integral and Jordan measure. The normality property above begins to make this connection formal. The next result further strenghens the two-way connection between the two notions.

\begin{thm}
  If $f$ is a nonnegative, bounded function on $[a,b]$, then $f$ is Riemann integrable if and only if the region $E=\set{(x,y)\mid0\leq y\leq f(x)}$ is Jordan measurable. Moreover, in this case we have $\int f=m(E)$.
\end{thm}

\begin{proof}
  First suppose that $f$ is Riemann integrable and let $\epsilon>0$ be given. Choose pc functions $g,h$ such that $g\leq f\leq h$ and $\text{pc}\int(g-h)<\epsilon$. Let $A$ be the region under the graph of $g$ and let $B$ be the region under the graph of $h$. It is clear that $A,B$ are elementary, $A\subset E\subset B$, and $m(B\setminus A)<\epsilon$.

  Conversely if $E$ is Jordan measurable we can find an elementary $A$ such that $A\subset E$ and $m(E\setminus A)<\epsilon$. Using our usual grid argument, we can suppose that there is a sequence of disjoint intervals $I_j$ such that $A$ is a union of boxes with horizontal sides selected from the $I_j$. Pairing each $I_j$ with the constant $c_j=$ the maximum of the vertical coordinates of all of the boxes with horizontal side $I_j$, we obtain a pc function $g$. It is easy to see that $m(A)\leq \text{pc}\int g\leq m(E)$. This shows that the lower Riemann integral of $f$ is $m(E)$. We can proceed similarly using an outer approximation $B$ to show that the upper Riemann integral of $f$ is $m(E)$ too.
\end{proof}

Depending on when you last studied Riemann integration, you may better recall Riemann's classical approach rather than the Darboux approach above. This version involves a quite expansive notation:

\begin{itemize}
\item $f$ denotes a real-valued, bounded function defined on the interval $[a,b]$.
\item $x_0,x_1,\ldots,x_k$ denotes an increasing sequence of points in $[a,b]$ (they will be rectangle endpoints), where $x_0=a$ and $x_k=b$.
\item $\mathcal P$ denotes the partition of $[a,b]$ into subintervals defined by the $x_i$, that is, into subintervals $[x_{i-1},x_i]$.
\item $\delta x_i$ denotes the length of the $i$th interval, $x_i-x_{i-1}$.
\item $\|\mathcal P\|$ denotes the norm of the partition, $\max\delta x_i$.
\item $x_1^*,\ldots,x_k^*$ denotes any selection of points such that $x_i^*\in[x_i,x_{i+1}]$.
\end{itemize}

With these pieces in hand, we can define the Riemann sums and the Riemann integral.

\begin{defn}
  With $f$, $\mathcal P$, $\delta x_i$, $x_i^*$ as above, the corresponding \emph{Riemann sum} is:
  \[\mathcal R(f,\mathcal  P,x_i^*)=\sum f(x_i^*)\delta x_i
  \]
  The \emph{Riemann integral} of $f$ on $[a,b]$ is then defined by
  \[R\int_a^b f=\lim_{\|\mathcal P\|\to0}\mathcal R(f,\mathcal P,x_i^*)
  \]
  provided this limit exists. Here the limit ``exists'' and equals $L$ if for all $\epsilon>0$ there exists $\delta>0$ such that for all $\mathcal P$ and $x_i^*$ we have $\|\mathcal P\|<\delta$ implies $|R(f,\mathcal P,x_i^*)-L|<\epsilon$.
\end{defn}

It is an exercise in both notation and partition management to check that $f$ is Riemann integrable in the Darboux sense described earlier in this section if and only if $f$ is Riemann integrable in the classical Riemann sense just defined.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction to Lebesgue measure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{reading}
  Tao, \S1.2, first few pages
\end{reading}

The Jordan measure that we have constructed works very well for the sets that it measures. And the Riemann integral works very well for the functions that it integrates. But there are several shortcomings that we have not discussed, and several more too.
\begin{itemize}
\item Unbounded sets are not Jordan measurable, and unbounded functions are not Riemann integrable
\item There are examples of bounded sets which are open or closed, but still not Jordan measurable
\item A countable union of Jordan measurable sets need not be Jordan measurable
\item A pointwise limit of Riemann integrable functions need not be Riemann integrable, even if it is again bounded
\end{itemize}

In this section we will tweak the definiton of Jordan measure. The resulting measure will be stronger, though it will be harder to establish that it has the properties we desire of a measure. Recalling the definition of Jordan outer measure, it is clear that we can write it as follows.
\[m^{*j}(A)=\inf\set{\left.\sum_1^k \vol(B_i)\;\right|\;\text{$B_i$ are boxes and }A\subset\bigcup_1^kB_i}
\]
The idea of the Lebesgue measure is simply to replace the finite union and summation with a countable one.

\begin{defn}
  Let $A$ be any subset of $\RR^n$. The \emph{Lebesgue outer measure} of $A$ is
  \[m^*(A)=\inf\set{\left.\sum_1^\infty \vol(B_i)\;\right|\;\text{$B_i$ are boxes and }A\subset\bigcup_1^\infty B_i}
  \]
\end{defn}

Notice that we have dropped the assumption that $A$ is bounded. There are many examples of unbounded sets with Lebesgue outer measure zero. In fact, every countable set has lebesgue outer measure zero.

We also remark that we will not define an ``inner'' version of Lebesgue measure analogous to the Jordan inner measure. The reason is that we do not wish to assume that positive measure sets will contain any positive volume boxes. For example, the set $[0,1]\setminus\QQ$ should have a measure of $1$ but has lower Jordan measure $0$. In fact, if one replaces the finite summation from Jordan inner measure with a countable summation, then the resulting value does not change!

Without an inner measure, we cannot define Lebesgue measurability simply by requiring outer measure equals inner measure. In order to find another way to define Lebesgue measurability, we recall that Jordan measurability could equivalently be stated: $A$ is Jordan measurable if and only if for all $\epsilon>0$ there exists an elementary set $E$ such that $A\subset E$ and $m^{*j}(E\setminus A)<\epsilon$.

\begin{defn}
  Let $A$ be any subset of $\RR^n$. We say that $A$ is \emph{Lebesgue measurable} if for every $\epsilon>0$ there exists an open set $O$ such that $A\subset O$ and $m^*(O\setminus A)<\epsilon$. When this is the case, we define $m(A)=m^*(A)$ to be the \emph{Lebesgue measure} of $A$.
\end{defn}

The definition can also be written with a countable union of boxes in place of the open set $O$; this is less elegant but allows greater symmetry with our definition of Lebesgue outer measure.

We will see in the rest of this section and the next that the Lebesgue measure agrees with the Jordan measure on the Jordan measurable sets, and moreover is capable of measuring significantly more sets. In fact the Lebesgue measurable sets encompass almost everything seen in real analysis and its applications, with exceptions including just certain set constructions from AC.  The Lebesgue measure also satisfies all the measure axioms that we have mentioned so far, including their countable versions.

Likewise, later on we will introduce the corresponding Lebesgue integral. This integral agrees with the Riemann integral, and is capable of integrating significantly more functions. It also has significantly stronger properties than the Riemann integral, including a countable version of linearity.

Before we begin working to establish all these claims, we study the Lebesgue outer measure further. Before continuing, it is useful to lay out what properties are expected of an outer measure. The following will be referred to as the \emph{outer measure axioms}.
\begin{enumerate}
\item (empty set) $m^*(\emptyset)=0$
\item (monotonicity) If $E\subset F$ then $m^*(E)\leq m^*(F)$
\item (countable subadditivity) $m^*(\bigcup E_n)\leq\sum m^*(E_n)$
\end{enumerate}
Since the outer measure applies to all sets, and we have seen there exist non-measurable sets, we do not expect it to satisfy additivity in general. Still axiom (c) is quite strong: the Jordan outer measure satisfies finite additivity but not countable subadditivity.

\begin{prop}
  The Lebesgue outer measure satisfies the outer measure axioms (a)--(c).
\end{prop}

\begin{proof}
  The axioms (a) and (b) are both trivial, so it remains to prove only axiom (c). Let $E_n$ be arbitrary sets and let $\epsilon>0$ be given. From the definition of Lebegue outer measure, for each $n$ we can find a sequence of boxes $B_i^n$ such that $E_n\subset\bigcup_iB_i^n$ and $\sum_im(B_i^n)<m^*(E_n)+\epsilon/2^n$.

  Taking unions, we have $\bigcup E_n\subset\bigcup_n\bigcup_iB_i^n$, and moreover:
  \begin{align*}
    m^*(\bigcup E_n)&\leq\sum_n\sum_i\vol(B_i^n)\\
                    &\leq\sum_n\left(m^*(E_n)+\epsilon/2^n\right)\\
                    &\leq\sum_nm^*(E_n)+2\epsilon
  \end{align*}
  Taking $\epsilon\to0$, we obtain the desired inequality $m^*(\bigcup E_n)\leq\sum m^*(E_n)$.
\end{proof}

The bookkeeping used in the above proof is called an ``$\epsilon/2^n$ argument'', and is used frequently in countable approximations.

In the next sections we will work to address under what circumstances the Lebesgue outer measure satisfies additivity or otherwise behaves well.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{More on Lebesgue outer measure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{reading}
  Tao, \S 1.2.1.
\end{reading}

We have shown that the Lebesgue outer measure satisfies countable subadditivity. We are really interested in additivity, but we know that even the finite additivity axiom cannot hold for all sets. In the end, we will prove that countable additivity is true for measurable sets. For the moment, we will be satisfied with the following version of additivity which holds in special cases.

%% But when is this used??

\begin{lem}
  Suppose that $E,F$ are separated, that is, that $d(E,F)=\inf\set{d(x,y)\mid x\in E, y\in F}>0$. Then $m^*(E\cup F)=m^*(E)+m^*(F)$.
\end{lem}

\begin{proof}
  Subbaditivity implies that $m^*(E\cup F)\leq m^*(E)+m^*(F)$, so it remains only to show $m^*(E\cup F)\geq m^*(E)+m^*(F)$. Applying the definition of $m^*(E\cup F)$, given any $\epsilon>0$ we can find boxes $B_i$ such that $E\cup F\subset\bigcup B_i$ and $\sum\vol(B_i)-m^*(E\cup F)<\epsilon$.

  Let us first consider an easy case when each $B_i$ meets at most one of the sets $E,F$. Then we can rewrite the sequence $\{B_i\}$ as $\{C_i\}\cup\{D_i\}$, where the $C_i$'s meet only $E$ and the $D_i$'s meet only $F$. Now
  \begin{align*}
    m^*(E\cup F)&>\sum\vol(B_i)-\epsilon\\
                &=\sum\vol(C_i)+\sum\vol(D_i)-\epsilon\\
                &\geq m^*(E)+m^*(F)-\epsilon
  \end{align*}
  Taking $\epsilon\to0$, we are done in this case.

  In the general case, we can reduce to the easy one by partitioning each $B_i$ into smaller boxes, each with diameter smaller than $d(E,F)$. Once this is done, each new box meets at most one of $E,F$ and we may proceed as above.
\end{proof}

Up to this point, we have not yet shown that $m^*$ ever takes a nonzero value! In fact $m^*$ satisfies a normality axiom that the outer measure of an elementary is equal to its elementary measure. When we proved this property for Jordan measure, we started by showing that one cannot partition an interval into finitely many subintervals whose lengths somehow add up to less than the original. For countable partitions this is intuitively still true, but much harder to show!

\begin{thm}
  If $E$ is an elementary subset of $\RR^n$, then $m^*(E)$ agrees with the elementary measure $m_e(E)$.
\end{thm}

\begin{proof}
  It is clear that $m^*(E)\leq m_e(E)$, since $E$ is itself a union of boxes whose volumes sum to $m(E)$. Thus it remains only to show $m^*(E)\geq m(E)$. Appealing to the definition of $m^*(E)$, given any $\epsilon>0$ we can find boxes $B_i$ such that $E\subset\bigcup B_i$ and $m^*(E)>\sum\vol(B_i)-\epsilon$. We would like to say that the latter quantity is $\geq m_e(E)$, but unfortunately the elementary measure is only \emph{finitely} subadditive.

  In order to proceed, let us temporarily assume that $E$ is closed and the $B_i$ are open. Then by the compactness of $E$, just finitely many of the $B_i$ are needed to cover $E$. Thus the above argument works in this case!

  In order to assume that the $B_i$ are open, we can enlarge each slightly and find an open box $B'_i$ such that $B_i\subset B'_i$ and $\vol(B'_i)-\vol(B_i)<\epsilon/2^n$.

  In order to assume that $E$ is closed, first write it as a finite union of disjoint boxes $C_1,\ldots C_k$. Shrinking each $C_i$ slightly, we can find a closed box $C'_i\subset C_i$ such that $m_e(C_i\setminus C'_i)<\epsilon/k$. Replacing $E$ with $\bigcup C'_i$ we obtain a closed set as desired.
\end{proof}

As a consequence of the theorem, we now know that finite additivity holds for $m^*$ for finite unions of disjoint boxes (after all it is true for the elementary measure). In fact it also holds for finite unions of almost disjoint boxes: here two boxes are said to be \emph{almost disjoint} if they have disjoint interiors. The next result extends this from finite to countable unions.

\begin{thm}
  Suppose $B_i$ is a sequence of pairwise almost disjoint boxes. Then $m^*(\bigcup B_i)=\sum\vol(B_i)$.
\end{thm}

\begin{proof}
  By subadditivity together with the previous theorem, we have $m^*(\bigcup B_i)\leq\sum m^*(B_i)=\sum\vol(B_i)$. Hence it remains only to show $m^*(\bigcup B_i)\geq\sum\vol(B_i)$. For this, let $N\in\NN$ be given, and note that $\bigcup_1^NB_i$ is an elementary set. Thus by monotonicity together with the previous theorem, we have
  \begin{align*}
    m^*(\bigcup B_i)&\geq m^*(\bigcup_1^NB_i)\\
                    &=m_e(\bigcup_1^NB_i)\\
                    &=\sum_1^N\vol(B_i)
  \end{align*}
  Taking $N\to\infty$, we obtain the desired inequality.
\end{proof}

We are finally making some progress: for unions of almost disjoint sequences of boxes, the additivity property holds and the measure of the union is equal to the expected quantity. This leads one to ask what kinds of sets can be written as unions of almost disjoint sequences of boxes, and the following result shows this at least includes the open sets.

\begin{prop}
  Any open set $O$ can be written as a union of a sequence of pairwise almost disjoint boxes.
\end{prop}

\begin{proof}
  Consider the family $\mathcal Q$ of \emph{dyadic cubes}, that is, cubes with each side of the form $[m/2^n,(m+1)/2^n]$ where $m\leq 2^n$. The family $\mathcal Q$ has the nesting property, that is, any two such cubes are almost disjoint or else one is contained in the other.

  It is not difficult to observe that $\mathcal Q$ is a basis for the topology of $\RR^n$. In particular, for any $x\in O$ there exists a cube $B_x\in\mathcal Q$ such that $x\in B_x\subset O$. Thu union of all $B_x$ for $x\in O$ is a covering of $O$ by dyadic cubes. Now eliminate duplicates from this covering, that is, remove any cube in the covering that is contained in some other cube of the covering. Since we have bounded the sizes of the cubes, there will still be maximal cubes left over. The result is a covering of $O$ by pairwise almost disjoint dyadic cubes.
\end{proof}

The above result gives a very direct method of calculating the Lebesgue outer measure (and hence the Lebesgue measure) of any open set! We close this section with the following so-called ``outer regularity lemma'', which shows that the Lebesgue outer measure is determined by its values on the open sets. When combined with the previous result, this gives a kind of general formula for the outer measure.

\begin{lem}
  Let $E$ be any subset of $\RR^n$. Then $m^*(E)=\inf\set{m^*(O)\mid\text{$O$ is open and }E\subset O}$.
\end{lem}

\begin{proof}
  It is clear from monotonicity of $m^*$ that $\leq$ holds. Thus it remains only to show $\geq$. Applying the definition of $m^*(E)$ we can find boxes $B_i$ such that $E\subset\bigcup B_i$ and $\sum\vol(B_i)-m^*(E)<\epsilon$. Arguing as in an earlier proof, we can enlarge the $B_i$ slightly to assume without loss of generality that they are open. Then
  \begin{align*}
    m^*(E)&\geq\sum\vol(B_i)-\epsilon\\
          &\geq m^*(\bigcup B_i)\\
          &\geq \inf\set{m^*(O)\mid\text{$O$ is open and }E\subset O}-\epsilon
  \end{align*}
  Taking $\epsilon\to0$, we obtain the desired result.
\end{proof}

In the next section we will use these partial results to conclude that the Lebesgue (outer) measure always behaves well on the measurable sets.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{More on Lebesgue measurability}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{reading}
  Tao, \S 1.2.2.
\end{reading}

Recall that a set $E$ is called Lebesgue measurable if it can be well-approximated from the outside by open sets. That is, if for all $\epsilon>0$ there is an open set $O$ such that $m^*(O\setminus E)<\epsilon$. In the last section we saw that open sets can be written as unions of boxes, and it turns out one may replace $O$ with a union of boxes in the definition.

It is tautological from the definition of measurability that open sets are Lebesgue measurable. In the next result we work to establish that many, many other sets are Lebesgue measurable too.

\begin{thm}
  Open and closed sets are Lebesgue measurable. Complements, countable unions, and countable intersections of measurable sets are measurable.
\end{thm}

\begin{proof}
  We have already established that open sets are Lebesgue measurable.

  For countable unions, suppose that $E_n$ are Lebesgue measurable. Given $\epsilon>0$, find open sets $O_n$ such that $E_n\subset O_n$ and $m^*(O_n\setminus E_n)<\epsilon/2^n$. Then we have
  \begin{align*}
    m^*(\bigcup O_n\smallsetminus\bigcup E_n)
    &\leq m^*(\bigcup O_n\setminus E_n)\\
    &\leq \sum m^*(O_n\setminus E_n)\\
    &\leq \sum \epsilon/2^n=2\epsilon
  \end{align*}
  This shows that $\bigcup E_n$ is measurable.

  For closed sets, assume first that $E$ is closed and bounded, and thus compact. Using the outer regularity lemma we can find an open set $O$ such that $E\subset O$ and $m^*(O)-m^*(E)<\epsilon$. We wish to show that $m^*(O\setminus E)<\epsilon$ too. Since $O\setminus E$ is open, we can write it as an almost disjoint union of closed dyadic cubes $C_n$. Then $\bigcup_1^N C_n$ is compact and thus separated from the compact set $E$. We proved that additivity holds for separated sets, so we have:
  \begin{align*}
    m^*(E)+m^*(\bigcup_1^NC_i)&=m^*(E\cup\bigcup_1^NC_i)\\
                              &\leq m^*(O)\\
                              &<m^*(E)+\epsilon
  \end{align*}
  It follows that $\sum_1^N\vol(C_i)=m^*(\bigcup_1^NC_i)<\epsilon$, and taking $N\to\infty$ we have $\sum\vol(C_i)\leq\epsilon$. This shows that $m^*(O\setminus E)\leq\epsilon$, as desired.

  In general a closed set can be written as a countable union of compact sets, and we have already handled the case of countable unions.

  For complements, let $E$ be measurable and for each $n$ find an open set $O_n$ such that $E\subset O_n$ and $m^*(O_n\setminus E)<1/n$. Then we have $m^*(\bigcap O_n\setminus E)=0$. Meanwhile taking complements we have $\bigcup O_n^c\subset E^c$ and $m^*(E^c\setminus\bigcup O_n^c)=0$. In particular $E^c$ can be expressed as a union of the two measurable sets $\bigcup O_n^c$ and $E^c\setminus\bigcup O_n^c$. Thus $E^c$ is measurable too.

  For countable intersections, we can simply apply Demorgan's laws to reduce it to complements and countable unions. Whew!
\end{proof}

The above theorem thus shows that the Lebesgue measurable sets form a \emph{$\sigma$-algebra}, that is, a family of sets that is closed under countable unions, countable intersections, and complements. It moreover shows that the Lebesgue measurable sets includes the well-known class of \emph{Borel sets}, that is, the $\sigma$-algebra generated by the open and closed sets. The Borel sets sets are often identified as those which can be \emph{explicitly described}. Most sets we encounter in analysis can be explicitly described and are thus Borel and Lebesgue measurable.

We now know that Borel sets are Lebesgue measurable, null sets are Lebesgue measurable, and the measurable sets form a $\sigma$-algebra. The next result concludes that this information characterizes the Lebesgue measurable sets.

\begin{prop}
  The collection of Lebesgue measurable sets is the least $\sigma$-algebra containing both the open sets and the Lebesgue null sets.
\end{prop}

\begin{proof}
  It is clear that the Lebesgue measurable sets are a $\sigma$-algebra containing the open sets and the Lebesgue null sets. On the othe hand suppose that $E$ is a Lebesgue measurable set. By the previous lemma for all $n$ we can find open sets $O_n$ such that $E\subset O_n$ and $m^*(O_n\setminus E)<1/n$. It follows that $N=\bigcap O_n\setminus E$ is Lebesgue null. Now have that
  \[E=\bigcap(O_n)\cap N^c
  \]
  and thus $E$ lies in the algebra generated by the open sets and the Lebesgue null sets.
\end{proof}

We conclude this section with some useful equivalents of Lebesgue measurability, similar to the ones we developed for Jordan measurability. The following result implies that the Lebesgue measurable sets can be characterized as those which are ``almost open.''

\begin{lem}
  A set $E$ is Lebesgue measurable if and only if for all $\epsilon>0$ there exists an open set $O$ such that $m^*(O\triangle E)<\epsilon$.
\end{lem}

\begin{proof}
  Our original definition of Lebesgue measurability automatically gives an open set $O$ such that $m^*(O\triangle E)<\epsilon$. Conversely, let $E$ be any set and suppose the condition holds. Then for any $\epsilon$ we can find an open set $O_\epsilon$ such that $m^*(O_\epsilon\triangle E)<\epsilon$. Let $U_\epsilon=\bigcup O_{\epsilon/2^k}$. Then it is not difficult to check that $m^*(U_\epsilon\setminus E)\leq\epsilon$, and $m^*(E\setminus U_\epsilon)=0$. Finally letting $F=\bigcap_nU_{1/n}$ we have that $F$ is a measurable set and both $m^*(E\setminus F)=0$ and $m^*(F\smallsetminus E)=0$. We have thus shown that $E$ differs from a measurable set by a null set, and we leave it as an exercise to check that this implies $E$ is measurable too.
\end{proof}

Perhaps even more surprising, the Lebesgue measurable sets of finite measure can be characterized as those which are ``almost elementary''.

\begin{lem}
  A set $E$ is Lebesgue measurable with finite Lebesgue measure if and only if for all $\epsilon>0$ there exists an elementary set $A$ such that $m^*(A\triangle E)<\epsilon$.
\end{lem}

\begin{proof}
  Suppose that $E$ is Lebesgue measurable and let $\epsilon>0$ be given. Let $O$ be an open set such that $E\subset O$ and $m^*(O\setminus E)<\epsilon$. Then $O$ can be written as a union of almost disjoint boxes $O=\bigcup B_i$, and we know that $m(O)=\sum\vol(B_i)$.

  Now $m(O)<m(E)+\epsilon$ and the right-hand side is finite, so the sum $\sum\vol(B_i)$ converges. Thus there exists some $N$ such that $\sum_{N+1}^\infty\vol(B_i)<\epsilon$. Letting $A=\bigcup_1^NB_i$, we have that $A$ is elementary and $m(O\setminus A)<\epsilon$. Thus we have
  \begin{align*}
    m^*(E\triangle A)&=m^*(E\setminus A)+m^*(A\setminus E)\\
                     &\leq m^*(O\setminus A)+m^*(O\setminus E)\\
                     &<2\epsilon
  \end{align*}
  which is sufficient to prove the implication. The converse implication is similar to the previous lemma.
\end{proof}

We have now established many useful properties of the outer measure $m^*$ and shown that it has a broad collection of measurable sets. In the next section we will confirm as promised that $m^*$ behaves very well when restricted to the collection of measurable sets.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{More on Lebesgue measure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{reading}
  Tao, \S 1.2.2
\end{reading}

In the previous section we established that many sets are Lebesgue measurable. When $E$ is Lebesgue measurable we simply write $m(E)$ for $m^*(E)$, and we call $m$ the \emph{Lebesgue measure}. We are finally ready to prove that the Lebesgue measure satisfies the requirements of a measure that we laid out in the first section, at least with respect to the Lebesgue measurable sets.

\begin{thm}
  The Lebesge measure satisfies the axioms
  \begin{enumerate}
  \item (normality) if $B$ is a box then $m(B)=\vol(B)$
  \item (translation-invariance) $m(E+x)=m(E)$ for every measurable set $E$
  \item (countable additivity) $m(\bigcup E_n)=\sum m(E_n)$ for every sequence of pairwise disjoint measurable sets $E_n$
  \end{enumerate}
\end{thm}

\begin{proof}
  We have already established normality for $m=m^*$, and translation-invariance is clear from the definitions.

  For countable additivity, first recall that we always have subadditivity so we need only show $m(\bigcup E_n)\geq\sum m(E_n)$. Suppose first that the $E_n$ are compact. Then they are pairwise separated, so by induction we can establish that $m(\bigcup_1^NE_n)=\sum_1^Nm(E_n)$. It follows that $m(\bigcup E_n)\geq\sum_1^Nm(E_n)$. Taking $N\to\infty$ we have $m(\bigcup E_n)\geq\sum m(E_n)$ as desired.

  Next assume that the $E_n$ are bounded but not necessarily closed. By the measurability of $E_n^c$ we can find open sets $O_n$ such that $E_n^c\subset O_n$ and $m^*(O_n\setminus E_n)<\epsilon/2^n$. Taking complements we thus have compact sets $K_n\subset E_n$ such that $m^*(E_n\setminus K_n)<\epsilon/2^n$. Now using the additivity for compact sets,
  \begin{align*}
    m(\bigcup E_n)&\geq m(\bigcup K_n)\\
                  &=\sum m(K_n)\\
                  &\geq\sum(m(E_n)-\epsilon/2^n)\\
                  &=\sum m(E_n)-\epsilon
  \end{align*}
  Taking $\epsilon\to0$, we are finished in this case.

  Finally for general $E_n$, decompose $\RR^d$ into disjoint bounded cells $A_m$. Then $E_n=\bigcup_mE_n\cap A_m$.
  \begin{align*}
    m(\bigcup E_n)&=\sum_n\sum_mm(E_n\cap A_m)\\
                  &=\sum m(E_n)
  \end{align*}
  and the proof is complete.
\end{proof}

We have now established the existence and all of the promised axioms of the Lebesgue measure. Additional useful properties can be derived from the axioms, such as the following result concerning continuity of the measure function.

\begin{thm}
  \begin{itemize}
  \item (upwards monotone convergence theorem) If $E_n$ are measurable and $E_n\subset E_{n+1}$ then $m(\bigcup E_n)=\lim m(E_n)$.
  \item (downwards monotone convergence theorem) If $E_n$ are measurable and $E_{n+1}\subset E_n$ then $m(\bigcap E_n)=\lim m(E_n)$, provided some $E_n$ has finite measure.
  \end{itemize}
\end{thm}

\begin{proof}
  For the upwards MCT, let $E'_n=E_n\setminus E_{n-1}$ and note that the $E'_n$ are disjoint and have the same union $\bigcup E'_n=\bigcup E_n$. As a base case we let $E_0=\emptyset$. Applying countable additivity, we now have
  \begin{align*}
    m(\bigcup E_n)&=m(\bigcup E'_n)\\
                  &=\sum m(E'_n)\\
                  &=\sum m(E_n)-m(E_{n-1})\\
                  &=\lim_N\sum_1^N m(E_n)-m(E_{n-1})\\
                  &=\lim_N m(E_N)
  \end{align*}
  The last equality holds simply by telescoping cancellation, and gives us the desired result.

  For the downwards MCT, we can suppose without loss of generality that $E_1$ has finite measure. We thus take complements inside $E_1$ to obtain the sequence $F_n=E_1\setminus E_n$. Then the $F_n$ form an increasing sequence and $\bigcup F_n=E_1\setminus\bigcap E_n$. Using the upwards MCT, we now have
  \begin{align*}
    m(E_1)&=m(\bigcap E_n)+m(\bigcup F_n)\\
          &=m(\bigcap E_n)+\lim m(F_n)\\
          &=m(\bigcap E_n)+m(E_1)-\lim m(E_n)
  \end{align*}
  Cancelling the $m(E_1)$ from the first and last expression, we obtain that $0=m(\bigcap E_n)-\lim m(E_n)$, which implies the desired result.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Measure and integration}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Simple integration}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\chapter{Functional analysis}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Banach space}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\end{document}


